<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ROTM Admin Dashboard</title>
<style>
body { font-family: Arial; background:#111; color:#fff; padding:20px; max-width:1200px; margin:auto; }
h1, h2 { text-align:center; }
table { width:100%; border-collapse:collapse; margin-top:20px; }
th, td { border:1px solid #555; padding:10px; text-align:center; }
th { background:#333; }
tr.top1 { background:#d4af37; color:#111; font-weight:bold; }
tr.top2 { background:#c0c0c0; color:#111; font-weight:bold; }
tr.top3 { background:#cd7f32; color:#111; font-weight:bold; }
button { margin-top:20px; padding:10px 20px; font-size:16px; cursor:pointer; }
.tab-buttons { text-align:center; margin-top:20px; }
.tab-buttons button { margin:0 5px; }
.tab { display:none; }
.tab.active { display:block; }
</style>
</head>
<body>
<h1>ROTM Admin Dashboard</h1>

<div class="tab-buttons">
  <button id="scoresTabBtn">Scores</button>
  <button id="votesTabBtn">Detailed Votes</button>
</div>

<!-- Scores Tab -->
<div id="scoresTab" class="tab active">
  <table id="rankingTable">
    <thead>
      <tr>
        <th>Rank</th>
        <th>Video Title</th>
        <th>Reddit Upvotes</th>
        <th>Upvote Points</th>
        <th>Vote Points</th>
        <th>Total Score</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<!-- Votes Tab -->
<div id="votesTab" class="tab">
  <table id="votesTable">
    <thead>
      <tr>
        <th>User ID</th>
        <th>Rank 1</th>
        <th>Rank 2</th>
        <th>Rank 3</th>
        <th>Timestamp</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
import { getFirestore, collection, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDChk83uv5LqXHemAziEHO3YAqEROHjIbo",
  authDomain: "rotm-2a088.firebaseapp.com",
  projectId: "rotm-2a088"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// Tabs logic
const scoresTabBtn = document.getElementById("scoresTabBtn");
const votesTabBtn = document.getElementById("votesTabBtn");
const scoresTab = document.getElementById("scoresTab");
const votesTab = document.getElementById("votesTab");

scoresTabBtn.addEventListener("click", ()=>{scoresTab.classList.add("active"); votesTab.classList.remove("active");});
votesTabBtn.addEventListener("click", ()=>{votesTab.classList.add("active"); scoresTab.classList.remove("active");});

// Real-time listener for videos and votes
const videosCol = collection(db, "videos");
const votesCol = collection(db, "votes");

let videosData = {};
let votesData = [];

onSnapshot(videosCol, snapshot=>{
  snapshot.docs.forEach(doc=>{
    videosData[doc.id] = { ...doc.data(), votePoints:0, upvotePoints:0 };
  });
  calculateScores();
});

onSnapshot(votesCol, snapshot=>{
  votesData = snapshot.docs.map(doc=>({ id: doc.id, ...doc.data() }));
  calculateScores();
  renderVotes();
});

// Scoring logic
function calculateScores() {
  if(!votesData || !videosData) return;

  // Reset vote points
  Object.values(videosData).forEach(v=>v.votePoints=0);

  // Calculate vote points
  votesData.forEach(vote=>{
    if(vote.rank1 && videosData[vote.rank1]) videosData[vote.rank1].votePoints += 100;
    if(vote.rank2 && videosData[vote.rank2]) videosData[vo]()
