<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ROTM Admin Dashboard</title>
  <style>
    body { font-family: Arial; background:#111; color:#fff; padding:20px; max-width:1200px; margin:auto; }
    h1,h2 { text-align:center; }
    table { width:100%; border-collapse:collapse; margin-top:20px; }
    th,td { border:1px solid #555; padding:10px; text-align:center; }
    th { background:#333; }
    tr.top1 { background:#d4af37; color:#111; font-weight:bold; }
    tr.top2 { background:#c0c0c0; color:#111; font-weight:bold; }
    tr.top3 { background:#cd7f32; color:#111; font-weight:bold; }
    button { margin-top:20px; padding:10px 20px; font-size:16px; cursor:pointer; }
    .tab-buttons { text-align:center; margin-top:20px; }
    .tab-buttons button { margin:0 5px; }
    #resetButton { background-color: #c0392b; color: white; border: none; }
    .tab { display:none; }
    .tab.active { display:block; }
    #authStatus { text-align:center; margin-top:20px; font-size:18px; font-weight:bold; }
    #votesPieChart { max-width:600px; margin:20px auto; display:block; }
    #authBox { text-align:center; margin-top:20px; }
  </style>
</head>
<body>
  <h1>ROTM Admin Dashboard</h1>
  <div id="authStatus">Checking authentication...</div>
  <div id="authBox" style="display:none;">
    <button id="loginBtn">Sign in with Google</button>
  </div>

  <div id="adminContent" style="display:none;">
    <div class="tab-buttons">
      <button id="scoresTabBtn">Scores</button>
      <button id="votesTabBtn">Detailed Votes</button>
      <button id="resetButton">Reset All Votes</button>
      <button id="exportCSVBtn">Export CSV</button>
    </div>

    <div id="scoresTab" class="tab active">
      <table id="rankingTable">
        <thead>
          <tr>
            <th>Rank</th>
            <th>Video Title</th>
            <th>Reddit Upvotes</th>
            <th>Upvote Points</th>
            <th>Vote Points</th>
            <th>Total Score</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <div id="votesTab" class="tab">
      <canvas id="votesPieChart" width="400" height="400"></canvas>
      <table id="votesTable">
        <thead>
          <tr>
            <th>User ID</th>
            <th>Rank 1</th>
            <th>Rank 2</th>
            <th>Rank 3</th>
            <th>Timestamp</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <!-- External Libraries -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
    import { getFirestore, collection, onSnapshot, getDocs, deleteDoc } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js";
    import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js";
    import Chart from "https://cdn.jsdelivr.net/npm/chart.js";

    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyDChk83uv5LqXHemAziEHO3YAqEROHjIbo",
      authDomain: "rotm-2a088.firebaseapp.com",
      projectId: "rotm-2a088"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);
    const provider = new GoogleAuthProvider();

    const authStatus = document.getElementById("authStatus");
    const authBox = document.getElementById("authBox");
    const loginBtn = document.getElementById("loginBtn");
    const adminContent = document.getElementById("adminContent");

    // ---- Login button
    loginBtn.addEventListener("click", async () => {
      try {
        await signInWithPopup(auth, provider);
      } catch (e) {
        console.error("Login failed", e);
        authStatus.innerText = "Login failed. Try again.";
      }
    });

    // ---- Auth state
    onAuthStateChanged(auth, (user) => {
      if (user) {
        authStatus.innerText = "Signed in as " + user.email;
        authBox.style.display = "none";
        adminContent.style.display = "block";
        initDashboard();
      } else {
        authStatus.innerText = "Not signed in";
        authBox.style.display = "block";
        adminContent.style.display = "none";
      }
    });

    // ---- Dashboard (ranking + charts + CSV etc.)
    function initDashboard() {
      // TODO: your existing dashboard logic (ranking animation, pie chart, reset, export CSV)
    }
  </script>
</body>
</html>
